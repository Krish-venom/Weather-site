---
- name: Deploy Weather-site to Apache
  hosts: webservers
  become: yes

  vars:
    repo_branch: main
    repo_url: "https://github.com/Krish-venom/Weather-site.git"
    app_dir: /opt/weather-site
    apache_root: /var/www/html

  tasks:
    - name: Ensure Apache is installed
      apt:
        name: apache2
        state: present
        update_cache: yes

    - name: Ensure git is installed
      apt:
        name: git
        state: present
        update_cache: yes

    - name: Clone or update Weather-site repo
      git:
        repo: "{{ repo_url }}"
        dest: "{{ app_dir }}"
        version: "{{ repo_branch }}"
        force: yes

    - name: Copy website files to Apache document root
      copy:
        src: "{{ app_dir }}/"
        dest: "{{ apache_root }}/"
        owner: www-data
        group: www-data
        mode: '0644'
      notify: Restart Apache

  handlers:
    - name: Restart Apache
      service:
        name: apache2
        state: restarted
