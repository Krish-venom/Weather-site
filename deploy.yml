---
- name: Deploy Weather-site to Apache
  hosts: webservers
  become: yes

  vars:
    repo_branch: main
    repo_url: "https://github.com/Krish-venom/Weather-site.git"
    apache_root: /var/www/html

  tasks:
    - name: Ensure Apache is installed
      apt:
        name: apache2
        state: present
        update_cache: yes

    - name: Ensure Git is installed
      apt:
        name: git
        state: present
        update_cache: yes

    - name: Remove default Apache content
      file:
        path: "{{ apache_root }}"
        state: absent

    - name: Recreate Apache document root
      file:
        path: "{{ apache_root }}"
        state: directory
        owner: www-data
        group: www-data
        mode: '0755'

    - name: Clone Weather-site repo into Apache root
      git:
        repo: "{{ repo_url }}"
        dest: "{{ apache_root }}"
        version: "{{ repo_branch }}"
        force: yes

    - name: Set ownership and permissions for site files
      file:
        path: "{{ apache_root }}"
        owner: www-data
        group: www-data
        recurse: yes

    - name: Restart Apache
      service:
        name: apache2
        state: restarted
